# 总结

表达式是由一个或多个运算符组成的.([汇总](#12.汇总))

* 各种运算符的用法, 优先级, 结合律, 求值顺序
* 操作数的类型转换

---

[toc]

# 1.表达式基础

表达式由可选的运算符和一个或多个运算数（**operands**)组成; 对表达式求值时得到一个结果.

* 字面值和变量就是最简单的表达式, 其结果是它们自己的值. (没有运算符, 只有一个运算数)

## 1.1基本概念*

* 运算符按操作数的多少可分为:
  *  一元运算符(**unary operator**)
  * 二元运算符(**binary operator**)
  * 三元运算符(**ternary operator**)

* 运算符和操作数的组合
  * 对于含有多个运算符的复杂表达式来说, 要想求值需要解决这个关键问题: 运算顺序. 所以有关于运算符的一些规则
    * 运算符的优先级(**precedence**), 结合律(**associativity**)
    * 操作数的求值顺序(**order of evaluation**)

* 操作数的转换
  * 表达式求值时, 经常需要把操作数从一种类型转换另一种类型. 
* 重载运算符(**overloaded operator**)
  * C++定义了运算符作用于内置类型和复合类型的对象时所执行的操作/含义.
  * 运算符作用于类类型的对象时, 用户可以自行定义其含义; 因为运算符被赋予更多的意义, 所以被称为**重载运算符**.
  * 注意: 不能改变运算符的优先级和结合律, 还有操作数的数量.

* 左值(**Lvalue**)和右值(**Rvalue**)
  * 对象可以分为左值和右值.
    * 在C中, 左值是能够放在赋值语句左侧的值, 右值是不能放在赋值语句左侧的值.
    * 在C++中, 二者的区别就没那么简单了. 粗略地讲, 当一个对象被用作右值时, 用的是对象的值(它的内容); 当对象被用作左值时, 用的是对象的identity(它在内存中的位置).
  * 在运算符需要右值的地方可以使用左值, 反之不然.
  * 使用`decltype`时, 左值和右值有所不同; 左值: 相应的引用类型; 右值: 相应的类型

## 1.2优先级和结合律

复合表达式(**compound expression**)是指含有两个或以上运算符的表达式.

在复合表达式的求值过程中首先需要将运算符和操作数组合在一起. 而优先级(**precedence**)和结合律(**associativity**)决定了操作数组合的方式. 

* 优先级: 运算符的优先级越高, 运算符越先与操作数结合 
  * 优先级只是规定了运算符与对象的组合顺序, 并没有说明操作数按照什么顺序求值.
* 结合律: 在优先级相同时, 结合律决定运算符的结合顺序(从左向右, 或从右向左)
* 小括号可以无视上述的组合规则; 表达式中被括起来的部分被当成一个单元来求值, 然后再与其他部分一起按照默认组合规则来组合.
* 例子: ` 6+3*4/2-2` : `*`和`/`运算符的优先级比`+`,`-`的高; 而`*`和`/`有相同的优先级, 根据它们的结合律(左结合律), 应该从左向右结合. 因此式子等于`((6+((3*4)/2))-2)`

# 1.3求值顺序

大多数的运算符并没有规定求值顺序; 不能假设求值顺序, 因为求值顺序是未定义的.

* 对于没规定求值顺序的运算符, 如果表达式指向并修改同一个对象, 将引发错误并产生未定义的行为. 例子, `<<`运算符没有规定求值顺序

* ```c++
  int i = 0;
  cout << i << " " << ++i << endl;	// undefined
  ```

优先级规定了操作数的组合方式, 但是没有说明操作数按照什么顺序求值. 也就是说, 求值顺序是与优先级, 结合律无关.

* 例如: `int i = f1() * f2();`, 可以知道`()`函数调用运算符的优先级更高, 所以`f1()`和`f2()`是在执行乘法之前执行的. 但是, 我们无法知道`f1`和`f2`函数哪个先调用.
* `f() + g() * h() +j()`; 
  * 优先级规定了`g()`的返回值和`h()`的返回值相乘
  * 结合律规定了`f()`和`g()*h()`的乘积相加, 所得结果再与`j()`的返回值相加
  * `+`, `*`都没有规定求值顺序, 所以这四个函数的调用顺序是未定义的. 
  * 如果这些函数是不相干的函数, 即不会影响到同一个对象的状态, 那么该表达式是不受求值顺序影响的; 如果其中有函数影响到同一对象, 这是一条错误的表达式.

明确规定求值顺序的4种运算符

* 逻辑与运算符`&&`: 保证先求左操作数的值; 而且只有左操作数的值为`true`时才继续求右操作数的值
* 逻辑或运算符`||`: 保证先求左操作数的值; 而且只有左操作数的值为`false`时才继续求右操作数的值
* 条件运算符`?:`: 保证先求第一操作数的值; 根据第一操作数的值来决定下一个被求值的操作数
* 逗号运算符`,`: 保证先求左操作数的值, 再求右操作数的值

# 2.算术运算符

# 3.赋值运算符

# 4.逻辑和关系运算符

# 5.递增和递减运算符

# 6.成员访问运算符

# 7.条件运算符

# 8.位运算符

# 9.sizeof运算符

# 10.逗号运算符

# 11.类型转换

# 12.汇总

## 运算符的含义, 优先级和结合律

下表按优先级从高到低排序; 以空行分隔不同优先级的运算符; 以`L`和`R`表示左结合律和右结合律

| 结合律 |      运算符      | 功能                       | 用法                    |
| ------ | :--------------: | :------------------------- | ----------------------- |
| L      |       `::`       | 全局作用域                 | `::name`                |
| L      |       `::`       | 类作用域                   | `class::name`           |
| L      |       `::`       | 命名空间作用域             | `namespace::name`       |
|        |                  |                            |                         |
| L      |       `.`        | 成员选择                   | `obejct.member`         |
| L      |       `->`       | 成员选择                   | `pointer->member`       |
| L      |       `[]`       | 下标                       | `expr[expr]`            |
| L      |       `()`       | 函数调用                   | `name(expr_list)`       |
| L      |       `()`       | 类型转换                   | `type(expr_list)`       |
|        |                  |                            |                         |
| R      |       `++`       | 后置递增运算               | `lvalue++`              |
| R      |       `--`       | 后置递减运算               | `lvalue--`              |
| R      |     `typeid`     | 类型ID                     | `typeid(type)`          |
| R      |     `typeid`     | 运行时类型ID               | `typeid(expr)`          |
| R      |     显式转换     | 类型转换                   | `cast_name<type>(expr)` |
|        |                  |                            |                         |
| R      |       `++`       | 前置递增运算               | `++lvalue`              |
| R      |       `--`       | 前置递减运算               | `--lvalue`              |
| R      |       `~`        | 位求反                     | `~expr`                 |
| R      |       `!`        | 逻辑非                     | `!expr`                 |
| R      |       `-`        | 一元负号                   | `-expr`                 |
| R      |       `+`        | 一元正号                   | `+expr`                 |
| R      |       `*`        | 解引用                     | `*expr`                 |
| R      |       `&`        | 取地址                     | `&lavlue`               |
| R      |       `()`       | 类型转换                   | `(type)expr`            |
| R      |     `sizeof`     | 对象的大小                 | `sizeof(expr)`          |
| R      |     `sizeof`     | 类型的大小                 | `sizeof(type)`          |
| R      |   `sizeof...`    | 参数包的大小               | `sizeof...(name)`       |
| R      |      `new`       | allocate object/分配对象   | `new type`              |
| R      |     `new[]`      | allocate array/分配数组    | `new type[size]`        |
| R      |     `delete`     | deallocate object/释放对象 | `delete expr`           |
| R      |    `delete[]`    | 释放数组                   | `delete[] expr`         |
| R      |    `noexcept`    | 允许抛出异常               | `noexcept(expr)`        |
|        |                  |                            |                         |
| L      |      `->*`       | 指向成员选择的指针         | `ptr->*ptr_to_member`   |
| L      |       `.*`       | 指向成员选择的指针         | `obj.*ptr_to_member`    |
|        |                  |                            |                         |
| L      |       `*`        | 乘法                       | `expr*expr`             |
| L      |       `/`        | 除法                       | `expr/expr`             |
| L      |       `%`        | 取模(取余)                 | `expr%expr`             |
|        |                  |                            |                         |
| L      |       `+`        | 加法                       | `expr+expr`             |
| L      |       `-`        | 减法                       | `expr-expr`             |
|        |                  |                            |                         |
| L      |       `<<`       | 位左移                     | `expr<<expr`            |
| L      |       `>>`       | 位右移                     | `expr>>expr`            |
|        |                  |                            |                         |
| L      |       `<`        | 小于                       | `expr<expr`             |
| L      |       `<=`       | 小于或等于                 | `expr<=expr`            |
| L      |       `>`        | 大于                       | `expr>expr`             |
| L      |       `>=`       | 大于或等于                 | `expr>=expr`            |
|        |                  |                            |                         |
| L      |       `==`       | 相等性                     | `expr==expr`            |
| L      |       `!=`       | 不等性                     | `expr!=expr`            |
|        |                  |                            |                         |
| L      |       `&`        | 位与                       | `expr&expr`             |
|        |                  |                            |                         |
| L      |       `^`        | 位异或                     | `expr^expr`             |
|        |                  |                            |                         |
| L      |       `|`        | 位或                       | `expr|expr`             |
|        |                  |                            |                         |
| L      |       `&&`       | 逻辑与                     | `expr&&expr`            |
|        |                  |                            |                         |
| L      |       `||`       | 逻辑或                     | `expr||expr`            |
|        |                  |                            |                         |
| R      |       `?:`       | 条件                       | `expr?expr:expr`        |
|        |                  |                            |                         |
| R      |       `=`        | 赋值                       | `lvalue=expr`           |
| R      | `*=`, `\=`, `%=` | 复合赋值                   | `lvalue+=expr`等        |
| R      |    `+=`, `-=`    | 同上                       |                         |
| R      |  `<<=`, `>>=`,   | 同上                       |                         |
| R      |  `&=`,`=`, `^=`  | 同上                       |                         |
|        |                  |                            |                         |
| R      |     `throw`      | 抛出异常                   | `throw expr`            |
|        |                  |                            |                         |
| L      |       `,`        | 逗号                       | `expr, expr`            |

## 求值顺序

明确规定求值顺序的4种运算符

* 逻辑与运算符`&&`: 保证先求左操作数的值; 而且只有左操作数的值为`true`时才继续求右操作数的值
* 逻辑或运算符`||`: 保证先求左操作数的值; 而且只有左操作数的值为`false`时才继续求右操作数的值
* 条件运算符`?:`: 保证先求第一操作数的值; 根据第一操作数的值来决定下一个被求值的操作数
* 逗号运算符`,`: 保证先求左操作数的值, 再求右操作数的值